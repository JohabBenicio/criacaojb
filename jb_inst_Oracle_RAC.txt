-- -----------------------------------------------------------------------------------
-- Autor               : Johab Benicio de Oliveira.
-- Descrição           : Instalação do Oracle RAC 
-- Virtualização       : VMware 10
-- Linux usado         : Oracle Linux 5.9
-- Versão Oracle       : Oracle 11.2.0.3
-- Nome do arquivo     : jb_inst_Oracle_RAC.txt
-- Data de criação     : 16/09/2014
-- Data de atualização : 18/09/2014
-- -----------------------------------------------------------------------------------


-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------
--------------------                                                                     --------------------
--------------------                    CONFIGURACAO DO SERVER DNS                       --------------------
--------------------                                                                     --------------------
-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------

RAM: 300 MB
DISCO: 10 GB

-- ------------------------------------------------------------------------------------------------
-- DNS Server: rac-dns.localdomain -> Servidor de DNS
-- Configure DNS server for SCAN VIPs, rac VIPs and rac IPs:
-- ------------------------------------------------------------------------------------------------
  
RPMs required in setting up DNS server:

-- -----------------------
-- Esta no CD do Linux   -
-- -----------------------

rpm -Uvh bind-utils-9.3.6-20.*
rpm -Uvh bind-libs-9.3.6-20.*
rpm -Uvh bind-libs-9.3.6-20.*
rpm -Uvh bind-9.3.6-20.P1.el5_*
rpm -ivh numactl-devel-0.9.8-12.0.3.el5_6.* 
rpm -Uvh system-config-bind-*
rpm -Uvh ypbind-1.19-12.*
rpm -Uvh bind-chroot-9.*



-- ------------------------------------------------------------------------------------------------
-- "hostname"
-- ------------------------------------------------------------------------------------------------

sysctl kernel.hostname=rac-dns.com.br

# hostname
rac-dns


-- ------------------------------------------------------------------------------------------------
-- "/etc/sysconfig/network"
-- ------------------------------------------------------------------------------------------------

NETWORKING=yes
NETWORKING_IPV6=yes
HOSTNAME=rac-dns


- --------------------------------------------------------------------------------------------------------------------------------------------
- Configuração das placas de REDE "/etc/sysconfig/network-scripts/ifcfg-eth*"
- --------------------------------------------------------------------------------------------------------------------------------------------

ifconfig -a | grep eth
eth0      Link encap:Ethernet  Endereço de HW 00:0C:29:A7:CA:11  

- ------------------------------
- Editar o arquivo "ifcfg-eth0" 
- ------------------------------

vi /etc/sysconfig/network-scripts/ifcfg-eth0

DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
HWADDR=00:0c:29:a7:ca:11
IPADDR=172.16.43.200



-- ------------------------------------------------------------------------------------------------
-- "resolv.conf"
-- ------------------------------------------------------------------------------------------------
 
vi /etc/resolv.conf 
i

; generated by /sbin/dhclient-script
search com.br
nameserver 172.16.43.200  # <- IP do servidor DNS



-- ------------------------------------------------------------------------------------------------ 
-- Configuração dos arquivos para setup do DNS:
-- ------------------------------------------------------------------------------------------------
 /var/named/chroot/etc/named.conf                               << A ser criado
/var/named/chroot/var/named/localdomain.zone                   << A ser criado
/var/named/chroot/var/named/43.16.172.in-addr.arpa.zone        << A ser criado
/var/named/chroot/var/named/0.0.10.in-addr.arpa.zone           << A ser criado
 

-- ------------------------------------------------------------------------------------------------
-- Configuração do "named.conf"
-- ------------------------------------------------------------------------------------------------

mkdir -p /var/named/chroot/etc/named.conf

rm -f /var/named/chroot/etc/named.conf
vi /var/named/chroot/etc/named.conf
i

options {
		directory "/var/named";
    	#pid-file "/var/named/chroot/var/run/named/named.pid";

        // Set IP address correctly.
        listen-on port 53 {  172.16.43.200; 172.16.43.150; 172.16.43.151; };


        //
        // Leave the rest of the config as it is.
        //

        // My Additions
        // Forwarder: Anything this DNS can t resolve gets forwarded to my ISPs DNS.
        forwarders { 172.16.43.200; };
	// End My Additions

};

// Zone for this RAC configuration is com.br
 
zone "com.br" in {
  type master;
  file "localdomain.zone";
  allow-update { none; };
};
 
// For reverse lookups
 
zone "43.16.172.in-addr.arpa" in {
  type master;
  file "43.16.172.in-addr.arpa";
  allow-update { none; };
};
 
zone "0.0.10.in-addr.arpa" in {
  type master;
  file "0.0.10.in-addr.arpa";
  allow-update { none; };
};

zone "." in {
type hint;
file "/dev/null";
};

include "/etc/rndc.key";







-- ------------------------------------------------------------------------------------------------
-- Configurando a camada publica "172.16.43"
-- ------------------------------------------------------------------------------------------------


mkdir -p /var/named/chroot/var/named

rm -f vi /var/named/chroot/var/named/localdomain.zone

vi /var/named/chroot/var/named/localdomain.zone
i
 
$TTL    1d
@  IN    SOA   rac-dns.com.br. root.com.br. (
    100        ; se = serial number
    8h         ; ref = refresh
    5m         ; ret = update retry
    3w         ; ex = expiry
    3h         ; min = minimum
    )
 
    IN    NS    rac-dns.com.br.
 
; DNS server
rac-dns       IN    A    172.16.43.200
 
; RAC racs Public name
rac1          IN    A    172.16.43.150
rac2          IN    A    172.16.43.151
 
; RAC racs Public VIPs
rac1-vip      IN    A    172.16.43.160
rac2-vip      IN    A    172.16.43.161

; RAC racs PRIV 
rac1-priv     IN    A    10.0.0.1
rac2-priv     IN    A    10.0.0.2

; 3 SCAN VIPs
rac-scan       IN    A    172.16.43.201
rac-scan       IN    A    172.16.43.202
rac-scan       IN    A    172.16.43.203


 
 

-- ------------------------------------------------------------------------------------------------
-- Configurando a camada publica "172.16.43"
-- ------------------------------------------------------------------------------------------------

rm -f vi /var/named/chroot/var/named/43.16.172.in-addr.arpa

vi /var/named/chroot/var/named/43.16.172.in-addr.arpa
i

$TTL    1d
@   IN    SOA   rac-dns.com.br. root.com.br. (
    100        ; se = serial number
    8h         ; ref = refresh
    5m         ; ret = update retry
    3w         ; ex = expiry
    3h         ; min = minimum
    )
 
    IN    NS    rac-dns.com.br.
 
; DNS machine name in reverse
200        IN    PTR rac-dns.com.br.
 
; RAC racs Public Name in Reverse
 
150          IN    PTR     rac1.com.br.
151          IN    PTR     rac2.com.br.
 
; RAC racs Public VIPs in Reverse
 
160          IN    PTR     rac1-vip.com.br.
161          IN    PTR     rac2-vip.com.br.
 
; RAC racs SCAN VIPs in Reverse
 
201         IN    PTR      rac-scan.com.br.
202         IN    PTR      rac-scan.com.br.
203         IN    PTR      rac-scan.com.br.




-- ------------------------------------------------------------------------------------------------
-- Configurando a camada privada "10.0.0"
-- ------------------------------------------------------------------------------------------------
 


rm -f vi /var/named/chroot/var/named/0.0.10.in-addr.arpa

vi /var/named/chroot/var/named/0.0.10.in-addr.arpa
i

$TTL    1d
@   IN    SOA   rac-dns.com.br. root.com.br. (
    100        ; se = serial number
    8h         ; ref = refresh
    5m         ; ret = update retry
    3w         ; ex = expiry
    3h         ; min = minimum
    )
 
    IN    NS    rac-dns.com.br.
  
; RAC racs Public VIPs in Reverse
 
1          IN    PTR     rac1-priv.com.br.
2          IN    PTR     rac2-priv.com.br.
 

 



---------------------------------------------------------------------------------------------


chown named.named /var/named/chroot/var/named/*


---------------------------------------------------------------------------------------------


Start the DNS Service (named):
 
service named restart

chkconfig --level 35 named on
 

 chmod 775 *  /var/named/chroot/var/named


-- -------------------------------------------------------------------------------------
-- Configurar "/etc/hosts" no servidor de DNS
-- -------------------------------------------------------------------------------------


vi /etc/hosts


# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1       rac-dns.com.br rac-dns  localhost.localdomain localhost
::1		localhost6.localdomain6 localhost6

#----------------------------------------------------------------------------------#
# Enderecos Publicos do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.150      rac1.com.br              rac1
172.16.43.151      rac2.com.br              rac2

#----------------------------------------------------------------------------------#
# Enderecos Virtuais do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.160      rac1-vip.com.br          rac1-vip
172.16.43.161      rac2-vip.com.br          rac2-vip

#----------------------------------------------------------------------------------#
# Oracle Cluster Interconnect                                                      #
#----------------------------------------------------------------------------------#
10.0.0.1           rac1-priv.com.br         rac1-priv
10.0.0.2           rac2-priv.com.br         rac2-priv

#----------------------------------------------------------------------------------#
# SCAN do Oracle Real Application Cluster                                          #
#----------------------------------------------------------------------------------#
#172.16.43.201      rac-scan.com.br          rac-scan
#172.16.43.202      rac-scan.com.br          rac-scan
#172.16.43.203      rac-scan.com.br          rac-scan
#----------------------------------------------------------------------------------#





-- -------------------------------------------------------------------------------------
-- Realizar teste do DNS
-- -------------------------------------------------------------------------------------

[root@as-server named]# nslookup rac-scan
Server:		172.16.43.200     # <--- IP do servidor de DNS
Address:	172.16.43.200#53

Name:	rac-scan.com.br
Address: 172.16.43.201
Name:	rac-scan.com.br
Address: 172.16.43.202
Name:	rac-scan.com.br
Address: 172.16.43.203


[root@as-server named]# nslookup 172.16.43.201
Server:		172.16.43.200
Address:	172.16.43.200#53

201.43.16.172.in-addr.arpa	name = rac-scan.com.br.


[root@as-server named]# nslookup rac1
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac1.com.br
Address: 172.16.43.150

[root@as-server named]# nslookup rac2
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac2.com.br
Address: 172.16.43.151









-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------
--------------------                                                                     --------------------
--------------------                    CONFIGURACAO DO NODE 1                           --------------------
--------------------                                                                     --------------------
-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------


Recomendo fazer uma partição chamada "/u01". Padrão Oracle.

Caso tenha duvidas da instalação, segue abaixo o link oficial da Oracle para instalação do Oracle 11g R2.
http://docs.oracle.com/cd/E11882_01/install.112/e24326/toc.htm

Caso não encontre os RPMs para o oracleasm, segue abaixo o link de download.
http://www.oracle.com/technetwork/topics/linux/asmlib/index-101839.html


Oracle recomenda as seguintes definições mínimo.

Instale os seguintes pacotes se eles não estiverem presentes.

	rpm -ivh binutils-2.17.50*

	rpm -ivh compat-libstdc++-33*
	
	rpm -ivh elfutils-libelf-0*
	
	rpm -ivh elfutils-libelf-devel-* 
	
	rpm -ivh expat-1.*

	rpm -ivh gcc-4.1.2-*

	rpm -ivh gcc-c++-4.1.2*

	rpm -ivh glibc-2.*

	rpm -ivh glibc-common-*

	rpm -ivh glibc-devel-2*

	rpm -ivh glibc-headers-*
	
	rpm -ivh libaio-0.* 
	
	rpm -ivh libaio-devel-0.*
	
	rpm -ivh ksh-20100*
	
	rpm -ivh libgcc-4.1.*

	rpm -ivh libstdc++-4.1.*

	rpm -ivh libstdc++-devel-4.*

	rpm -ivh make-3.81-3.e*
	
	rpm -ivh pdksh-*

	rpm -ivh sysstat-7.0.2-11.el5.i386.rpm
	
	rpm -ivh unixODBC-libs-2.2.11*
	
	rpm -ivh unixODBC-2.2.1*

	rpm -ivh unixODBC-devel-2.*
	
	rpm -ivh oracleasm-support-*
	
	rpm -ivh oracleasmlib-2.*
	
	rpm -ivh oracleasm-2.6.18-*

	rpm -ivh numactl-devel-0.9.8-12.0.3.el5_6.*

	rpm -Uvh sysstat-7.0.2*




cd /
eject

- Para verificar os pacotes instalados.

rpm -qa 

[root@rac1 /]# rpm -qa | grep oracleasm
				oracleasm-2.6.18-348.el5xen-2.0.5-1.el5
				oracleasm-support-2.1.7-1.el5


- -------------------------------------------------------------------------------------------------------------------------------------------
- Verifique se o sistema de arquivos de memória compartilhada é grande o suficiente para o Gerenciador de memória automática para trabalhar.
- -------------------------------------------------------------------------------------------------------------------------------------------

umount tmpfs
mount -t tmpfs shmfs -o size=1500m /dev/shm

- Tornar a configuração permanente através da alteração da "tmpfs" configuração do /etc/fstab arquivo para olhar como este.

tmpfs                   /dev/shm                tmpfs   size=1500m      0 0


- -------------------------------------------------------------------------------------------------------------------------------------------
- Criar usuario e grupos para instalação do RAC
- -------------------------------------------------------------------------------------------------------------------------------------------


groupadd -g 501 oinstall
groupadd -g 502 dba
groupadd -g 503 oper

groupadd -g 504 asmadmin
groupadd -g 506 asmdba
groupadd -g 507 asmoper

useradd -u 501 -g oinstall -G dba,asmdba,asmoper,asmadmin grid
useradd -u 502 -g oinstall -G dba,asmdba,oper oracle

passwd grid
passwd oracle



- --------------------------------------------------------------------------------------------------------------------------------------------
- Desativar garantir linux editando o arquivo "/etc/selinux/config" arquivo, certificando-se a bandeira SELINUX é definido da seguinte forma.
- --------------------------------------------------------------------------------------------------------------------------------------------

SELINUX=disabled




- ------------------------------------------------------------------------------------------------------------------------
- configurar /etc/hosts
- Ja que vamos usar o DNS, entao temos que deixa os rac-scan's comentados 
- ------------------------------------------------------------------------------------------------------------------------

vi /etc/hosts

# Do not remove the following line, or various programs
# that require network functionality will fail.

127.0.0.1          rac1.com.br   rac1  localhost.com.br        localhost
::1		localhost6.localdomain6 localhost6

#----------------------------------------------------------------------------------#
# Enderecos Publicos do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.150      rac1.com.br              rac1
172.16.43.151      rac2.com.br              rac2

#----------------------------------------------------------------------------------#
# Enderecos Virtuais do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.160      rac1-vip.com.br          rac1-vip
172.16.43.161      rac2-vip.com.br          rac2-vip

#----------------------------------------------------------------------------------#
# Oracle Cluster Interconnect                                                      #
#----------------------------------------------------------------------------------#
10.0.0.1           rac1-priv.com.br         rac1-priv
10.0.0.2           rac2-priv.com.br         rac2-priv

#----------------------------------------------------------------------------------#
# SCAN do Oracle Real Application Cluster                                          #
#----------------------------------------------------------------------------------#
#172.16.43.201      rac-scan.com.br          rac-scan
#172.16.43.202      rac-scan.com.br          rac-scan
#172.16.43.203      rac-scan.com.br          rac-scan
#----------------------------------------------------------------------------------#


- --------------------------------------------------------------------------------------------------------------------------------------------
- Configuração das placas de REDE "/etc/sysconfig/network-scripts/ifcfg-eth*"
- --------------------------------------------------------------------------------------------------------------------------------------------

ifconfig -a | grep eth
eth0      Link encap:Ethernet  HWaddr 00:0C:29:AD:99:66  
eth1      Link encap:Ethernet  HWaddr 00:0C:29:AD:99:70  

- -------------------------------------------
- Editar o arquivo vi "ifcfg-eth0" no node 1
- Configuração IP Publico
- -------------------------------------------

vi /etc/sysconfig/network-scripts/ifcfg-eth0

DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=172.16.43.150
NETWORK=172.16.43.0
NETMASK=255.255.255.0
DHCP_HOSTNAME=rac1.com.br
HWADDR=00:0C:29:AD:99:66  

- -------------------------------------------
- Editar o arquivo vi "ifcfg-eth1" no node 1
- Configuração Interconnect (IP Privado)
- -------------------------------------------

vi /etc/sysconfig/network-scripts/ifcfg-eth1

DEVICE=eth1
BOOTPROTO=static
ONBOOT=yes
IPADDR=10.0.0.1
NETMASK=255.0.0.0
NETWORK=10.0.0.0
DHCP_HOSTNAME=rac1-priv.com.br
HWADDR=00:0C:29:AD:99:70  

- ---------------------------------------------------------------
- Logo apos de fazer as alterações, reinicie os serviços da REDE.
- ---------------------------------------------------------------

service network restart


-- ------------------------------------------------------------------------------------------------
-- Configuração do "/etc/resolv.conf"
-- ------------------------------------------------------------------------------------------------
 
vi /etc/resolv.conf 
i

; generated by /sbin/dhclient-script
search com.br
nameserver 172.16.43.200  # <- IP do servidor DNS



-- -------------------------------------------------------------------------------------
-- Realizar teste do DNS
-- -------------------------------------------------------------------------------------

- Node 1

nslookup rac1
Server:		172.16.43.200  # <--- IP do servidor de DNS
Address:	172.16.43.200#53

Name:	rac1.com.br
Address: 172.16.43.150


nslookup rac-scan
Server:		172.16.43.200   # <--- IP do servidor de DNS
Address:	172.16.43.200#53

Name:	rac-scan.com.br
Address: 172.16.43.202
Name:	rac-scan.com.br
Address: 172.16.43.203
Name:	rac-scan.com.br
Address: 172.16.43.201


-- -----------------------------------------------------------------------------------------------------------------------
-- Configuração do Network Time Protocol
-- -----------------------------------------------------------------------------------------------------------------------
# Nesta instalação, o Oracle Time Synchronization Service é usado sobre o sistema Linux desde ntpd. 
# Então, ele precisa desativado e desinstalado para evitar qualquer possibilidade de ser em conflito com Oracle’s Cluster Time Sync Service (ctss).

root@rac1 [prod1] $ chkconfig ntpd off
root@rac1 [prod1] $ mv /etc/ntp.conf /etc/ntp.conf.orig
root@rac1 [prod1] $ rm /var/run/ntpd.pid
rm: cannot lstat '/var/run/ntpd.pid': Arquivo ou diretório não encontrado

-- -----------------------------------------------------------------------------------------------------------------------
-- Se você estiver usando NTP, você deve adicionar o "-x" opção para a seguinte linha no arquivo /etc/sysconfig/ntpd 
-- -----------------------------------------------------------------------------------------------------------------------

vi /etc/sysconfig/ntpd 

OPTIONS="-x -u ntp:ntp -p /var/run/ntpd.pid"

- -------------------------
- Em seguida, reinicie NTP
- -------------------------
service ntpd restart

chkconfig --list | grep ntpd

-- -----------------------------------------------------------------------------------------------------------------------
-- Adicionar ou alterar as seguintes linhas no arquivo  "/etc/sysctl.conf".
-- -----------------------------------------------------------------------------------------------------------------------

vi /etc/sysctl.conf

kernel.shmmni = 4096
kernel.shmmax = 1048764416
kernel.shmall = 2097152
kernel.sem = 250 32000 100 128

fs.file-max = 6815744
fs.aio-max-nr = 1048576

# semaphores: semmsl, semmns, semopm, semmni

net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default=262144
net.core.rmem_max=4194304
net.core.wmem_default=262144
net.core.wmem_max=1048576



- Os valores atuais podem ser testados usando o seguinte comando.
/sbin/sysctl -a | grep <param-name>


-- -----------------------------------------------------------------------------------------------------------------------
-- Execute o comando "sysctl -p" para atualizar os parâmetros do kernel atual.
-- -----------------------------------------------------------------------------------------------------------------------
/sbin/sysctl -p


-- -----------------------------------------------------------------------------------------------------------------------
-- Adicione as seguintes linhas para o "/etc/security/limits.conf" arquivo.
-- -----------------------------------------------------------------------------------------------------------------------
grid		soft	nproc		2047
grid		hard	nproc		16384
grid		soft	nofile		1024
grid		hard	nofile		65536
oracle		soft	nproc		2047
oracle		hard	nproc		16384
oracle		soft	nofile		1024
oracle		hard	nofile		65536


-- -----------------------------------------------------------------------------------------------------------------------
-- Adicione as seguintes linhas para no arquivo /etc/pam.d/login.
-- -----------------------------------------------------------------------------------------------------------------------

# 11R2 pam limits
session    required     pam_limits.so


-- -----------------------------------------------------------------------------------------------------------------------
-- Edite o arquivo "/etc/profile" e adicione no final do mesmo o seguinte SHELL
-- -----------------------------------------------------------------------------------------------------------------------

# Definir padrão do limitis shell de login para 11gR2
if [ $USER = "oracle" ] || [ $USER = "grid" ]; then
if [ $SHELL = "/bin/ksh" ]; then
ulimit -p 16384
ulimit -n 65536
else
ulimit -u 16384 -n 65536
fi
umask 022
fi



-- -----------------------------------------------------------------------------------------------------------------------
-- Criar os diretórios em que o software Oracle será instalado.
-- -----------------------------------------------------------------------------------------------------------------------
-----------------------------
- Criando diretórios do GRID
-----------------------------

mkdir -p /u01/app/oraInventory
chown -R grid:oinstall /u01/app/oraInventory
chmod -R 775 /u01/app/oraInventory

mkdir -p /u01/app/11.2.0/grid
chown -R grid:oinstall /u01/app/11.2.0/grid
chmod -R 775 /u01/app/11.2.0/grid

------------------------------
- Criando diretórios do Oracle
------------------------------

mkdir -p /u01/app/oracle/product/11.2.0/db_1
chown -R oracle:oinstall /u01/app/oracle
chmod -R 775 /u01/app/oracle



-- -----------------------------------------------------------------------------------------------------------------------
-- Logar como o usuário "ORACLE" e adicione as seguintes linhas no final do ".bash_profile" arquivo, lembrando-se
-- de ajustar os parametros para sua instalação.
-- -----------------------------------------------------------------------------------------------------------------------


ORACLE_SID='prod1'; export ORACLE_SID

TMP=/tmp; export TMP

TMPDIR=$TMP; export TMPDIR

ORACLE_HOSTNAME=rac1.com.br; export ORACLE_HOSTNAME

ORACLE_BASE=/u01/app/oracle; export ORACLE_BASE

ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1; export DB_HOME

BASE_PATH=/usr/sbin:$PATH; export BASE_PATH

PATH=$ORACLE_HOME/bin:$BASE_PATH; export PATH

LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib; export LD_LIBRARY_PATH

CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib; export CLASSPATH
	
TNS_ADMIN=$ORACLE_HOME/network/admin;  export TNS_ADMIN

ORACLE_TERM=xterm; export ORACLE_TERM
	
alias sql='sqlplus / as sysdba' 
alias ifconfig='/sbin/ifconfig' 
alias prod1='export ORACLE_SID=prod1'

#################################################################
# BEGIN Change Linux prompt                                     |
#################################################################
PS1='\u@\h [$ORACLE_SID] $ '
HOSTNAME=$(uname -n)
set -o emacs

echo "**********************************************************"
echo "# Welcome on $HOSTNAME "
echo "# This is training server "
echo "# Server Oracle"
echo "# User oracle = owner oracle software *"
echo "**********************************************************"
echo " __________________________________________________ "
echo "|                                                  |"
printf "| Banco de dados Oracle                            |\n"
printf "| SID  -> %-40.40s |\n" $ORACLE_SID
printf "| HOME -> %-40.40s |\n" $ORACLE_HOME
printf "| HOST -> %-40.40s |\n" `hostname`
echo "|__________________________________________________|"
echo

#################################################################
# END Change Linux prompt                                       |
#################################################################




-- -----------------------------------------------------------------------------------------------------------------------
-- Logar como o "GRID" e adicione as seguintes linhas no final do ".bash_profile" arquivo, lembrando-se
-- de ajustar os parametros para sua instalação.
-- -----------------------------------------------------------------------------------------------------------------------


ORACLE_SID='+ASM1'; export ORACLE_SID

TMP=/tmp; export TMP

TMPDIR=$TMP; export TMPDIR

ORACLE_HOSTNAME=rac1.com.br; export ORACLE_HOSTNAME

ORACLE_BASE=/u01/app/oracle; export ORACLE_BASE

ORACLE_HOME=/u01/app/11.2.0/grid; export DB_HOME

BASE_PATH=/usr/sbin:$PATH; export BASE_PATH

PATH=$ORACLE_HOME/bin:$BASE_PATH; export PATH

LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib; export LD_LIBRARY_PATH

CLASSPATH=$ORACLE_HOME/JRE:$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib; export CLASSPATH
	
TNS_ADMIN=$ORACLE_HOME/network/admin;  export TNS_ADMIN

ORACLE_TERM=xterm; export ORACLE_TERM
	
alias sql='sqlplus / as sysdba' 
alias ifconfig='/sbin/ifconfig' 
alias asm='export ORACLE_SID=+ASM1'

#################################################################
# BEGIN Change Linux prompt                                     |
#################################################################
PS1='\u@\h [$ORACLE_SID] $ '
HOSTNAME=$(uname -n)
set -o emacs

echo "**********************************************************"
echo "# Welcome on $HOSTNAME "
echo "# This is training server "
echo "# Server Oracle"
echo "# User oracle = owner oracle software *"
echo "**********************************************************"
echo " __________________________________________________ "
echo "|                                                  |"
printf "| Banco de dados Oracle                            |\n"
printf "| SID  -> %-40.40s |\n" $ORACLE_SID
printf "| HOME -> %-40.40s |\n" $ORACLE_HOME
printf "| HOST -> %-40.40s |\n" `hostname`
echo "|__________________________________________________|"
echo

#################################################################
# END Change Linux prompt                                       |
#################################################################



-- -----------------------------------------------------------------------------------------------------------------------
-- Adicione dicos para o servidor para apresentar ao ASM, no meu caso, vou utilizar 7 discos
-- Caso seja uma esteja usando uma maquina virtual VMware, então edite o arquivo .vmx e mude o final.
-- -----------------------------------------------------------------------------------------------------------------------


disk.locking = "FALSE"

scsi0:1.present = "TRUE"
scsi0:1.fileName = "/home/johab/vmware/RAC/Discos/disk01.vmdk"
scsi0:1.writeThrough = "TRUE"
scsi0:1.mode = "independent-persistent"
scsi0:1.sharedBus = "VIRTUAL"
scsi0:1.virtualDev = "lsilogic"
scsi0:1.deviceType = "disk"
scsi0:1.redo = ""

scsi0:2.present = "TRUE"
scsi0:2.fileName = "/home/johab/vmware/RAC/Discos/disk02.vmdk"
scsi0:2.writeThrough = "TRUE"
scsi0:2.mode = "independent-persistent"
scsi0:2.sharedBus = "VIRTUAL"
scsi0:2.virtualDev = "lsilogic"
scsi0:2.deviceType = "disk"
scsi0:2.redo = ""

scsi0:3.present = "TRUE"
scsi0:3.fileName = "/home/johab/vmware/RAC/Discos/disk03.vmdk"
scsi0:3.writeThrough = "TRUE"
scsi0:3.mode = "independent-persistent"
scsi0:3.sharedBus = "VIRTUAL"
scsi0:3.virtualDev = "lsilogic"
scsi0:3.deviceType = "disk"
scsi0:3.redo = ""

scsi0:4.present = "TRUE"
scsi0:4.fileName = "/home/johab/vmware/RAC/Discos/disk04.vmdk"
scsi0:4.writeThrough = "TRUE"
scsi0:4.mode = "independent-persistent"
scsi0:4.sharedBus = "VIRTUAL"
scsi0:4.virtualDev = "lsilogic"
scsi0:4.deviceType = "disk"
scsi0:4.redo = ""

scsi0:5.present = "TRUE"
scsi0:5.fileName = "/home/johab/vmware/RAC/Discos/disck_volt01.vmdk"
scsi0:5.writeThrough = "TRUE"
scsi0:5.mode = "independent-persistent"
scsi0:5.sharedBus = "VIRTUAL"
scsi0:5.virtualDev = "lsilogic"
scsi0:5.deviceType = "disk"
scsi0:5.redo = ""

scsi0:6.present = "TRUE"
scsi0:6.fileName = "/home/johab/vmware/RAC/Discos/disck_volt02.vmdk"
scsi0:6.writeThrough = "TRUE"
scsi0:6.mode = "independent-persistent"
scsi0:6.sharedBus = "VIRTUAL"
scsi0:6.virtualDev = "lsilogic"
scsi0:6.deviceType = "disk"
scsi0:6.redo = ""

scsi0:8.present = "TRUE"
scsi0:8.fileName = "/home/johab/vmware/RAC/Discos/disck_volt03.vmdk"
scsi0:8.writeThrough = "TRUE"
scsi0:8.mode = "independent-persistent"
scsi0:8.sharedBus = "VIRTUAL"
scsi0:8.virtualDev = "lsilogic"
scsi0:8.deviceType = "disk"
scsi0:8.redo = ""




-- -----------------------------------------------------------------------------------------------------------------------
-- Utilize o comando "fdisk" para aprsentar os discos ao Linux.
-- O comando abaixo ira listar os discos no Linux que estão apresentados e formatados e os que não estão.
-- -----------------------------------------------------------------------------------------------------------------------

fdisk -l 
	
- Abaixo esta um exemplo de como sera feito a apresentação do disco para o Linux.

	
root@rac1 [prod1] $ fdisk /dev/sdb

Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel
Building a new DOS disklabel. Changes will remain in memory only,
until you decide to write them. After that, of course, the previous
content wont be recoverable.


The number of cylinders for this disk is set to 1305.
There is nothing wrong with that, but this is larger than 1024,
and could in certain setups cause problems with:
1) software that runs at boot time (e.g., old versions of LILO)
2) booting and partitioning software from other OSs
   (e.g., DOS FDISK, OS/2 FDISK)
Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): n
Command action
   e   extended
   p   primary partition (1-4)
p
Partition number (1-4): 1
First cylinder (1-1305, default 1):
Using default value 1
Last cylinder or +size or +sizeM or +sizeK (1-1305, default 1305):
Using default value 1305

Command (m for help): p

Disk /dev/sdb: 4294 MB, 4294967296 bytes
255 heads, 63 sectors/track, 522 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks   Id  System
/dev/sdb1               1         522     4192933+  83  Linux

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.


-- -----------------------------------------------------------------------------------------------------------------------
-- Caso seja necessario formatar os disco, segue um exemplo
-- -----------------------------------------------------------------------------------------------------------------------

dd if=/dev/zero of=[PARTIÇÃO] count=1 bs=[TAMANHO]

- exemplo

dd if=/dev/zero of=/dev/sdb1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sdc1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sdd1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sde1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sdf1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sdg1 count=10000 bs=4096
dd if=/dev/zero of=/dev/sdh1 count=10000 bs=4096


fdisk /dev/sdb
fdisk /dev/sdc
fdisk /dev/sdd
fdisk /dev/sde
fdisk /dev/sdf
fdisk /dev/sdg
fdisk /dev/sdh



-- -----------------------------------------------------------------------------------------------------------------------
-- Configurar ASMLib usando o seguinte comando.
-- O usuario deve ser o "grid" e o grupo "asmadmin"
-- -----------------------------------------------------------------------------------------------------------------------

/usr/sbin/oracleasm configure -i

- exemplo

[root@rac1 Server]# oracleasm configure -i
Configuring the Oracle ASM library driver.

This will configure the on-boot properties of the Oracle ASM library
driver.  The following questions will determine whether the driver is
loaded on boot and what permissions it will have.  The current values
will be shown in brackets ('[]').  Hitting <ENTER> without typing an
answer will keep that current value.  Ctrl-C will abort.

Default user to own the driver interface []: grid
Default group to own the driver interface []: asmadmin
Start Oracle ASM library driver on boot (y/n) [n]: y
Scan for Oracle ASM disks on boot (y/n) [y]: y
Writing Oracle ASM library driver configuration: done

-- -----------------------------------------------------------------------------------------------------------------------
-- Carregar o módulo do kernel usando o seguinte comando.
-- Somente executar.
-- -----------------------------------------------------------------------------------------------------------------------

/usr/sbin/oracleasm init


-- -----------------------------------------------------------------------------------------------------------------------
-- Agora vamos preparar os discos para apresentar ao ASM.
-- -----------------------------------------------------------------------------------------------------------------------

root@rac1 [prod1] $ fdisk -l | grep 'Disk' |egrep -v 'dm-'
Disk /dev/sda: 42.9 GB, 42949672960 bytes
Disk /dev/sdb: 4294 MB, 4294967296 bytes
Disk /dev/sdc: 4294 MB, 4294967296 bytes
Disk /dev/sdd: 4294 MB, 4294967296 bytes
Disk /dev/sde: 4294 MB, 4294967296 bytes
Disk /dev/sdg: 2147 MB, 2147483648 bytes
Disk /dev/sdh: 2147 MB, 2147483648 bytes
Disk /dev/sdf: 2147 MB, 2147483648 bytes


/usr/sbin/oracleasm createdisk VOTING01 /dev/sdg1

/usr/sbin/oracleasm createdisk VOTING02 /dev/sdh1

/usr/sbin/oracleasm createdisk VOTING03 /dev/sdf1

/usr/sbin/oracleasm createdisk DATA01 /dev/sdb1

/usr/sbin/oracleasm createdisk DATA02 /dev/sdc1

/usr/sbin/oracleasm createdisk DATA03 /dev/sdd1

/usr/sbin/oracleasm createdisk DATA04 /dev/sde1


-- --------------------------------------------
-- Caso precise deletar os discos apresentados
-- --------------------------------------------

/usr/sbin/oracleasm deletedisk VOTING01 

/usr/sbin/oracleasm deletedisk VOTING02

/usr/sbin/oracleasm deletedisk VOTING03

/usr/sbin/oracleasm deletedisk DATA01 

/usr/sbin/oracleasm deletedisk DATA02

/usr/sbin/oracleasm deletedisk DATA03 

/usr/sbin/oracleasm deletedisk DATA04 
	
-- -----------------------------------
-- Veja os discos listados para o ASM
-- -----------------------------------

/usr/sbin/oracleasm listdisks

DATA01
DATA02
DATA03
DATA04
VOTING01
VOTING02
VOTING03




-- -----------------------------------------------------------------------------------------------------------------------
-- Instale o pacote cvuqdisk que se encontra do disco do GRID
-- -----------------------------------------------------------------------------------------------------------------------

-- --------------------------------------
-- Entrar na pasta onde se encontra o RPM
-- --------------------------------------

root@rac1 [prod1] $ cd /u01/grid/rpm/

-- ------------------
-- Instalar o pacote
-- ------------------

root@rac1 [prod1] $ rpm -Uvh cvuqdisk-1.0.9-1.rpm 
Preparing...                ########################################### [100%]
Using default group oinstall to install package
   1:cvuqdisk               ########################################### [100%]

-- -------------------
-- Validar instalação
-- -------------------

root@rac1 [prod1] $ rpm -qa | grep cvuqdisk
cvuqdisk-1.0.9-1




-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------
--------------------                                                                     --------------------
--------------------                    CONFIGURACAO DO NODE 2                           --------------------
--------------------                                                                     --------------------
-------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------


- Após realizar todo procedimento acima, faça uma cópia deste ambiente para fazermos o node 2 do RAC.










- ------------------------------------------------------------------------------------------------------------------------
- configurar /etc/hosts
- Ja que vamos usar o DNS, entao temos que deixa os rac-scan's comentados 
- ------------------------------------------------------------------------------------------------------------------------

vi /etc/hosts


# Do not remove the following line, or various programs
# that require network functionality will fail.

127.0.0.1          rac2.com.br   rac2  localhost.com.br        localhost
::1		localhost6.localdomain6 localhost6

#----------------------------------------------------------------------------------#
# Enderecos Publicos do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.150      rac1.com.br              rac1
172.16.43.151      rac2.com.br              rac2

#----------------------------------------------------------------------------------#
# Enderecos Virtuais do Oracle Real Application Cluster                            #
#----------------------------------------------------------------------------------#
172.16.43.160      rac1-vip.com.br          rac1-vip
172.16.43.161      rac2-vip.com.br          rac2-vip

#----------------------------------------------------------------------------------#
# Oracle Cluster Interconnect                                                      #
#----------------------------------------------------------------------------------#
10.0.0.1           rac1-priv.com.br         rac1-priv
10.0.0.2           rac2-priv.com.br         rac2-priv

#----------------------------------------------------------------------------------#
# SCAN do Oracle Real Application Cluster                                          #
#----------------------------------------------------------------------------------#
#172.16.43.201      rac-scan.com.br          rac-scan
#172.16.43.202      rac-scan.com.br          rac-scan
#172.16.43.203      rac-scan.com.br          rac-scan
#----------------------------------------------------------------------------------#



- --------------------------------------------------------------------------------------------------------------------------------------------
- Configuração das placas de REDE "/etc/sysconfig/network-scripts/ifcfg-eth*"
- --------------------------------------------------------------------------------------------------------------------------------------------

ifconfig -a | grep eth
eth0      Link encap:Ethernet  Endereço de HW 00:0C:29:48:7E:E2  
eth1      Link encap:Ethernet  Endereço de HW 00:0C:29:48:7E:EC  

- ---------------------------------------
- Editar o arquivo "ifcfg-eth0" no node 2
- ---------------------------------------

vi /etc/sysconfig/network-scripts/ifcfg-eth0

DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=172.16.43.151
NETMASK=255.255.255.0
NETWORK=172.16.43.0
DHCP_HOSTNAME=rac2.com.br
HWADDR=00:0C:29:48:7E:E2


- ---------------------------------------
- Editar o arquivo "ifcfg-eth1" no node 2
- ---------------------------------------

vi /etc/sysconfig/network-scripts/ifcfg-eth1 

DEVICE=eth1
BOOTPROTO=static
ONBOOT=yes
IPADDR=10.0.0.2
NETWORK=10.0.0.0
NETMASK=255.0.0.0
DHCP_HOSTNAME=rac2-priv.com.br
HWADDR=00:0C:29:48:7E:EC

- ---------------------------------------------------------------
- Logo apos de fazer as alterações, reinicie os serviços da REDE
- ---------------------------------------------------------------

service network restart



-- --------------------------------------------------------------------------------------------------------------------------------------------
-- "hostname"
-- --------------------------------------------------------------------------------------------------------------------------------------------

sysctl kernel.hostname=rac2.com.br


-- --------------------------------------------------------------------------------------------------------------------------------------------
-- Caso necessario adicionar as permições novamente no grid
-- --------------------------------------------------------------------------------------------------------------------------------------------

usermod -G dba,asmoper,asmadmin,asmdba grid


-- --------------------------------------------------------------------------------------------------------------------------------------------
-- "/etc/sysconfig/network"
-- --------------------------------------------------------------------------------------------------------------------------------------------

vi /etc/sysconfig/network

NETWORKING=yes
NETWORKING_IPV6=yes
HOSTNAME=rac2.com.br


-- --------------------------------------------------------------------------------------------------------------------------------------------
-- "~/bash_profile"
-- --------------------------------------------------------------------------------------------------------------------------------------------

Atualizar o bash_profile do usuario "grid" e "oracle"

$ORACLE_HOSTNAME
$ORACLE_SID


-- --------------------------------------------------------------------------------------------------------------------------------------------
-- Faça um teste na REDE para ver se os nodes estão escutando um ao outro.
-- --------------------------------------------------------------------------------------------------------------------------------------------

-- --------------------
-- Node 1 para Node 2
-- --------------------


root@rac1 [prod1] $ nslookup rac2
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac2.com.br
Address: 172.16.43.151

root@rac1 [prod1] $ nslookup rac2-priv
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac2-priv.com.br
Address: 10.0.0.2

root@rac1 [prod1] $ nslookup rac-scan
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac-scan.com.br
Address: 172.16.43.202
Name:	rac-scan.com.br
Address: 172.16.43.203
Name:	rac-scan.com.br
Address: 172.16.43.201

root@rac1 [prod1] $ ping rac2
PING rac2.com.br (172.16.43.151) 56(84) bytes of data.
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=1 ttl=64 time=0.547 ms
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=2 ttl=64 time=0.558 ms

root@rac1 [prod1] $ ping rac2-priv
PING rac2-priv.com.br (10.0.0.2) 56(84) bytes of data.
64 bytes from rac2-priv.com.br (10.0.0.2): icmp_seq=1 ttl=64 time=0.526 ms
64 bytes from rac2-priv.com.br (10.0.0.2): icmp_seq=2 ttl=64 time=0.729 ms


-- --------------------
-- Node 2 para Node 1
-- --------------------

root@rac2 [prod2] $ nslookup rac1
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac1.com.br
Address: 172.16.43.150

root@rac2 [prod2] $ nslookup rac1-priv
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac1-priv.com.br
Address: 10.0.0.1

root@rac2 [prod2] $ nslookup rac-scan
Server:		172.16.43.200
Address:	172.16.43.200#53

Name:	rac-scan.com.br
Address: 172.16.43.203
Name:	rac-scan.com.br
Address: 172.16.43.201
Name:	rac-scan.com.br
Address: 172.16.43.202

root@rac2 [prod2] $ ping rac1
PING rac1.com.br (172.16.43.150) 56(84) bytes of data.
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=1 ttl=64 time=0.717 ms
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=2 ttl=64 time=0.584 ms

root@rac2 [prod2] $ ping rac1-priv
PING rac1-priv.com.br (10.0.0.1) 56(84) bytes of data.
64 bytes from rac1-priv.com.br (10.0.0.1): icmp_seq=1 ttl=64 time=0.747 ms
64 bytes from rac1-priv.com.br (10.0.0.1): icmp_seq=2 ttl=64 time=0.621 ms





-- --------------------------------------------------------------------------------------------------------------------------------------------
-- Execute o comando abaixo em um dos nodes.
-- sshUserSetup.sh -user <username> -hosts "<usuario espaço e o outro usuario>" -advanced -confirm
-- --------------------------------------------------------------------------------------------------------------------------------------------

cd /u01/grid/sshsetup

root@rac1 [prod1] $ ./sshUserSetup.sh -user grid -hosts "rac1 rac2" -advanced -confirm

The output of this script is also logged into /tmp/sshUserSetup_2014-09-16-17-34-14.log
Hosts are rac1 rac2
user is grid
Platform:- Linux 
Checking if the remote hosts are reachable
PING rac1.com.br (172.16.43.150) 56(84) bytes of data.
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=1 ttl=64 time=0.024 ms
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=2 ttl=64 time=0.057 ms
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=3 ttl=64 time=0.057 ms
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=4 ttl=64 time=0.049 ms
64 bytes from rac1.com.br (172.16.43.150): icmp_seq=5 ttl=64 time=0.049 ms

--- rac1.com.br ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 3999ms
rtt min/avg/max/mdev = 0.024/0.047/0.057/0.012 ms
PING rac2.com.br (172.16.43.151) 56(84) bytes of data.
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=1 ttl=64 time=0.577 ms
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=2 ttl=64 time=0.592 ms
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=3 ttl=64 time=0.626 ms
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=4 ttl=64 time=0.585 ms
64 bytes from rac2.com.br (172.16.43.151): icmp_seq=5 ttl=64 time=0.537 ms

--- rac2.com.br ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4003ms
rtt min/avg/max/mdev = 0.537/0.583/0.626/0.035 ms
Remote host reachability check succeeded.
The following hosts are reachable: rac1 rac2.
The following hosts are not reachable: .
All hosts are reachable. Proceeding further...
firsthost rac1
numhosts 2
The script will setup SSH connectivity from the host rac1.com.br to all
the remote hosts. After the script is executed, the user can use SSH to run
commands on the remote hosts or copy files between this host rac1.com.br
and the remote hosts without being prompted for passwords or confirmations.

NOTE 1:
As part of the setup procedure, this script will use ssh and scp to copy
files between the local host and the remote hosts. Since the script does not
store passwords, you may be prompted for the passwords during the execution of
the script whenever ssh or scp is invoked.

NOTE 2:
AS PER SSH REQUIREMENTS, THIS SCRIPT WILL SECURE THE USER HOME DIRECTORY
AND THE .ssh DIRECTORY BY REVOKING GROUP AND WORLD WRITE PRIVILEDGES TO THESE
directories.

Do you want to continue and let the script make the above mentioned changes (yes/no)?
Confirmation provided on the command line

The user chose yes
Please specify if you want to specify a passphrase for the private key this script will create for the local host. Passphrase is used to encrypt the private key and makes SSH much more secure. Type 'yes' or 'no' and then press enter. In case you press 'yes', you would need to enter the passphrase whenever the script executes ssh or scp. 
The estimated number of times the user would be prompted for a passphrase is 4. In addition, if the private-public files are also newly created, the user would have to specify the passphrase on one additional occasion. 
Enter 'yes' or 'no'.
no

The user chose no
The files containing the client public and private keys already exist on the local host. The current private key may have a passphrase associated with it. In case you find using passphrase inconvenient(although it is more secure), you can change to it empty through this script. Press 'change' if you want the script to change the passphrase for you. Press 'no' if you want to use your old passphrase, if you had one.

The user chose 
Creating .ssh directory on local host, if not present already
Creating authorized_keys file on local host
Changing permissions on authorized_keys to 644 on local host
Creating known_hosts file on local host
Changing permissions on known_hosts to 644 on local host
Creating config file on local host
If a config file exists already at /root/.ssh/config, it would be backed up to /root/.ssh/config.backup.
./sshUserSetup.sh: line 432: [: =: unary operator expected
./sshUserSetup.sh: line 440: [: =: unary operator expected
Creating .ssh directory and setting permissions on remote host rac1
THE SCRIPT WOULD ALSO BE REVOKING WRITE PERMISSIONS FOR group AND others ON THE HOME DIRECTORY FOR grid. THIS IS AN SSH REQUIREMENT.
The script would create ~grid/.ssh/config file on remote host rac1. If a config file exists already at ~grid/.ssh/config, it would be backed up to ~grid/.ssh/config.backup.
The user may be prompted for a password here since the script would be running SSH on host rac1.
Warning: Permanently added 'rac1,172.16.43.150' (RSA) to the list of known hosts.
grid@rac1's password:   #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Coloque a senha do grid do node 1
Done with creating .ssh directory and setting permissions on remote host rac1.
Creating .ssh directory and setting permissions on remote host rac2
THE SCRIPT WOULD ALSO BE REVOKING WRITE PERMISSIONS FOR group AND others ON THE HOME DIRECTORY FOR grid. THIS IS AN SSH REQUIREMENT.
The script would create ~grid/.ssh/config file on remote host rac2. If a config file exists already at ~grid/.ssh/config, it would be backed up to ~grid/.ssh/config.backup.
The user may be prompted for a password here since the script would be running SSH on host rac2.
Warning: Permanently added 'rac2,172.16.43.151' (RSA) to the list of known hosts.
grid@rac2 s password:   #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Coloque a senha do grid do node 2
Done with creating .ssh directory and setting permissions on remote host rac2.
Copying local host public key to the remote host rac1
The user may be prompted for a password or passphrase here since the script would be using SCP for host rac1.
grid@rac1 s password:   #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Coloque a senha do grid do node 1
Done copying local host public key to the remote host rac1
Copying local host public key to the remote host rac2
The user may be prompted for a password or passphrase here since the script would be using SCP for host rac2.
grid@rac2 s password:   #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< Coloque a senha do grid do node 2
Done copying local host public key to the remote host rac2
Creating keys on remote host rac1 if they do not exist already. This is required to setup SSH on host rac1.
Generating public/private rsa key pair.
Your identification has been saved in .ssh/id_rsa.
Your public key has been saved in .ssh/id_rsa.pub.
The key fingerprint is:  #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< APENAS TECLE [ENTER]
92:49:9b:66:19:66:3b:46:92:30:66:89:b0:71:9c:6d grid@rac1.com.br
Creating keys on remote host rac2 if they do not exist already. This is required to setup SSH on host rac2.
Generating public/private rsa key pair.
Your identification has been saved in .ssh/id_rsa.
Your public key has been saved in .ssh/id_rsa.pub.
The key fingerprint is:  #<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< APENAS TECLE [ENTER]
0d:f3:c8:57:0b:ec:36:65:38:7c:2d:59:46:90:9a:79 grid@rac2.com.br
Updating authorized_keys file on remote host rac1
Updating known_hosts file on remote host rac1
Updating authorized_keys file on remote host rac2
Updating known_hosts file on remote host rac2
SSH setup is complete.

------------------------------------------------------------------------
Verifying SSH setup
===================
The script will now run the date command on the remote nodes using ssh
to verify if ssh is setup correctly. IF THE SETUP IS CORRECTLY SETUP,
THERE SHOULD BE NO OUTPUT OTHER THAN THE DATE AND SSH SHOULD NOT ASK FOR
PASSWORDS. If you see any output other than date or are prompted for the
password, ssh is not setup correctly and you will need to resolve the
issue and set up ssh again.
The possible causes for failure could be:
1. The server settings in /etc/ssh/sshd_config file do not allow ssh
for user grid.
2. The server may have disabled public key based authentication.
3. The client public key on the server may be outdated.
4. ~grid or ~grid/.ssh on the remote host may not be owned by grid.
5. User may not have passed -shared option for shared remote users or
may be passing the -shared option for non-shared remote users.
6. If there is output in addition to the date, but no password is asked,
it may be a security alert shown as part of company policy. Append the
additional text to the <OMS HOME>/sysman/prov/resources/ignoreMessages.txt file.
------------------------------------------------------------------------
--rac1:--
Running /usr/bin/ssh -x -l grid rac1 date to verify SSH connectivity has been setup from local host to rac1.
IF YOU SEE ANY OTHER OUTPUT BESIDES THE OUTPUT OF THE DATE COMMAND OR IF YOU ARE PROMPTED FOR A PASSWORD HERE, IT MEANS SSH SETUP HAS NOT BEEN SUCCESSFUL. Please note that being prompted for a passphrase may be OK but being prompted for a password is ERROR.
Ter Set 16 17:35:56 BRT 2014
------------------------------------------------------------------------
--rac2:--
Running /usr/bin/ssh -x -l grid rac2 date to verify SSH connectivity has been setup from local host to rac2.
IF YOU SEE ANY OTHER OUTPUT BESIDES THE OUTPUT OF THE DATE COMMAND OR IF YOU ARE PROMPTED FOR A PASSWORD HERE, IT MEANS SSH SETUP HAS NOT BEEN SUCCESSFUL. Please note that being prompted for a passphrase may be OK but being prompted for a password is ERROR.
Ter Set 16 17:35:56 BRT 2014
------------------------------------------------------------------------
------------------------------------------------------------------------
Verifying SSH connectivity has been setup from rac1 to rac1
IF YOU SEE ANY OTHER OUTPUT BESIDES THE OUTPUT OF THE DATE COMMAND OR IF YOU ARE PROMPTED FOR A PASSWORD HERE, IT MEANS SSH SETUP HAS NOT BEEN SUCCESSFUL.
bash: -c: line 0: unexpected EOF while looking for matching `"'
bash: -c: line 1: syntax error: unexpected end of file
------------------------------------------------------------------------
------------------------------------------------------------------------
Verifying SSH connectivity has been setup from rac1 to rac2
IF YOU SEE ANY OTHER OUTPUT BESIDES THE OUTPUT OF THE DATE COMMAND OR IF YOU ARE PROMPTED FOR A PASSWORD HERE, IT MEANS SSH SETUP HAS NOT BEEN SUCCESSFUL.
bash: -c: line 0: unexpected EOF while looking for matching `"'
bash: -c: line 1: syntax error: unexpected end of file
------------------------------------------------------------------------
-Verification from complete-
SSH verification complete.




-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Validar pré-requisitos do RAC
-- Verifique se esta tudo certo antes de começar a instalação
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- Caso te retorne erro no valor dos parametros (shmmax,shmall,shmmni...) do /etc/sysctl.conf, pode ignorar, pois na instalação ele vai ajusta no final, nos alertas.

./runcluvfy.sh stage -pre crsinst -n rac1,rac2 -verbose




grid@rac1 [+ASM1] $ ./runcluvfy.sh stage -pre crsinst -n rac1,rac2 -verbose


Performing pre-checks for cluster services setup 

Checking node reachability...

Check: Node reachability from node "rac1"
  Destination Node                      Reachable?              
  ------------------------------------  ------------------------
  rac2                                  yes                     
  rac1                                  yes                     
Result: Node reachability check passed from node "rac1"


Checking user equivalence...

Check: User equivalence for user "grid"
  Node Name                             Status                  
  ------------------------------------  ------------------------
  rac2                                  passed                  
  rac1                                  passed                  
Result: User equivalence check passed for user "grid"

Checking node connectivity...

Checking hosts config file...
  Node Name                             Status                  
  ------------------------------------  ------------------------
  rac2                                  passed                  
  rac1                                  passed                  

Verification of the hosts config file successful


Interface information for node "rac2"
 Name   IP Address      Subnet          Gateway         Def. Gateway    HW Address        MTU   
 ------ --------------- --------------- --------------- --------------- ----------------- ------
 eth0   172.16.43.151   172.16.43.0     0.0.0.0         UNKNOWN         00:0C:29:48:7E:E2 1500  
 eth1   10.0.0.2        10.0.0.0        0.0.0.0         UNKNOWN         00:0C:29:48:7E:EC 1500  


Interface information for node "rac1"
 Name   IP Address      Subnet          Gateway         Def. Gateway    HW Address        MTU   
 ------ --------------- --------------- --------------- --------------- ----------------- ------
 eth0   172.16.43.150   172.16.43.0     0.0.0.0         UNKNOWN         00:0C:29:AD:99:66 1500  
 eth1   10.0.0.1        10.0.0.0        0.0.0.0         UNKNOWN         00:0C:29:AD:99:70 1500  


Check: Node connectivity of subnet "172.16.43.0"
  Source                          Destination                     Connected?      
  ------------------------------  ------------------------------  ----------------
  rac2[172.16.43.151]             rac1[172.16.43.150]             yes             
Result: Node connectivity passed for subnet "172.16.43.0" with node(s) rac2,rac1


Check: TCP connectivity of subnet "172.16.43.0"
  Source                          Destination                     Connected?      
  ------------------------------  ------------------------------  ----------------
  rac1:172.16.43.150              rac2:172.16.43.151              passed          
Result: TCP connectivity check passed for subnet "172.16.43.0"


Check: Node connectivity of subnet "10.0.0.0"
  Source                          Destination                     Connected?      
  ------------------------------  ------------------------------  ----------------
  rac2[10.0.0.2]                  rac1[10.0.0.1]                  yes             
Result: Node connectivity passed for subnet "10.0.0.0" with node(s) rac2,rac1


Check: TCP connectivity of subnet "10.0.0.0"
  Source                          Destination                     Connected?      
  ------------------------------  ------------------------------  ----------------
  rac1:10.0.0.1                   rac2:10.0.0.2                   passed          
Result: TCP connectivity check passed for subnet "10.0.0.0"


Interfaces found on subnet "172.16.43.0" that are likely candidates for a private interconnect are:
rac2 eth0:172.16.43.151
rac1 eth0:172.16.43.150

Interfaces found on subnet "10.0.0.0" that are likely candidates for a private interconnect are:
rac2 eth1:10.0.0.2
rac1 eth1:10.0.0.1

WARNING: 
Could not find a suitable set of interfaces for VIPs
Checking subnet mask consistency...
Subnet mask consistency check passed for subnet "172.16.43.0".
Subnet mask consistency check passed for subnet "10.0.0.0".
Subnet mask consistency check passed.

Result: Node connectivity check passed

Checking multicast communication...

Checking subnet "172.16.43.0" for multicast communication with multicast group "230.0.1.0"...
Check of subnet "172.16.43.0" for multicast communication with multicast group "230.0.1.0" passed.

Checking subnet "10.0.0.0" for multicast communication with multicast group "230.0.1.0"...
Check of subnet "10.0.0.0" for multicast communication with multicast group "230.0.1.0" passed.

Check of multicast communication passed.

Checking ASMLib configuration.
  Node Name                             Status                  
  ------------------------------------  ------------------------
  rac2                                  passed                  
  rac1                                  passed                  
Result: Check for ASMLib configuration passed.

Check: Total memory 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          1.9535GB (2048368.0KB)    1.5GB (1572864.0KB)       passed    
  rac1          1.9535GB (2048368.0KB)    1.5GB (1572864.0KB)       passed    
Result: Total memory check passed

Check: Available memory 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          1.7962GB (1883468.0KB)    50MB (51200.0KB)          passed    
  rac1          1.5595GB (1635268.0KB)    50MB (51200.0KB)          passed    
Result: Available memory check passed

Check: Swap space 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          3.9068GB (4096536.0KB)    2.9302GB (3072552.0KB)    passed    
  rac1          3.9068GB (4096536.0KB)    2.9302GB (3072552.0KB)    passed    
Result: Swap space check passed

Check: Free disk space for "rac2:/tmp" 
  Path              Node Name     Mount point   Available     Required      Status      
  ----------------  ------------  ------------  ------------  ------------  ------------
  /tmp              rac2          /             3.6943GB      1GB           passed      
Result: Free disk space check passed for "rac2:/tmp"

Check: Free disk space for "rac1:/tmp" 
  Path              Node Name     Mount point   Available     Required      Status      
  ----------------  ------------  ------------  ------------  ------------  ------------
  /tmp              rac1          /             3.6728GB      1GB           passed      
Result: Free disk space check passed for "rac1:/tmp"

Check: User existence for "grid" 
  Node Name     Status                    Comment                 
  ------------  ------------------------  ------------------------
  rac2          passed                    exists(501)             
  rac1          passed                    exists(501)             

Checking for multiple users with UID value 501
Result: Check for multiple users with UID value 501 passed 
Result: User existence check passed for "grid"

Check: Group existence for "oinstall" 
  Node Name     Status                    Comment                 
  ------------  ------------------------  ------------------------
  rac2          passed                    exists                  
  rac1          passed                    exists                  
Result: Group existence check passed for "oinstall"

Check: Group existence for "dba" 
  Node Name     Status                    Comment                 
  ------------  ------------------------  ------------------------
  rac2          passed                    exists                  
  rac1          passed                    exists                  
Result: Group existence check passed for "dba"

Check: Membership of user "grid" in group "oinstall" [as Primary]
  Node Name         User Exists   Group Exists  User in Group  Primary       Status      
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              yes           yes           yes           yes           passed      
  rac1              yes           yes           yes           yes           passed      
Result: Membership check for user "grid" in group "oinstall" [as Primary] passed

Check: Membership of user "grid" in group "dba" 
  Node Name         User Exists   Group Exists  User in Group  Status          
  ----------------  ------------  ------------  ------------  ----------------
  rac2              yes           yes           yes           passed          
  rac1              yes           yes           yes           passed          
Result: Membership check for user "grid" in group "dba" passed

Check: Run level 
  Node Name     run level                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          5                         3,5                       passed    
  rac1          5                         3,5                       passed    
Result: Run level check passed

Check: Hard limits for "maximum open file descriptors" 
  Node Name         Type          Available     Required      Status          
  ----------------  ------------  ------------  ------------  ----------------
  rac2              hard          65536         65536         passed          
  rac1              hard          65536         65536         passed          
Result: Hard limits check passed for "maximum open file descriptors"

Check: Soft limits for "maximum open file descriptors" 
  Node Name         Type          Available     Required      Status          
  ----------------  ------------  ------------  ------------  ----------------
  rac2              soft          1024          1024          passed          
  rac1              soft          1024          1024          passed          
Result: Soft limits check passed for "maximum open file descriptors"

Check: Hard limits for "maximum user processes" 
  Node Name         Type          Available     Required      Status          
  ----------------  ------------  ------------  ------------  ----------------
  rac2              hard          16384         16384         passed          
  rac1              hard          16384         16384         passed          
Result: Hard limits check passed for "maximum user processes"

Check: Soft limits for "maximum user processes" 
  Node Name         Type          Available     Required      Status          
  ----------------  ------------  ------------  ------------  ----------------
  rac2              soft          2047          2047          passed          
  rac1              soft          2047          2047          passed          
Result: Soft limits check passed for "maximum user processes"

Check: System architecture 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          x86_64                    x86_64                    passed    
  rac1          x86_64                    x86_64                    passed    
Result: System architecture check passed

Check: Kernel version 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          2.6.39-300.26.1.el5uek    2.6.18                    passed    
  rac1          2.6.39-300.26.1.el5uek    2.6.18                    passed    
Result: Kernel version check passed

Check: Kernel parameter for "semmsl" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              250           250           250           passed          
  rac1              250           250           250           passed          
Result: Kernel parameter check passed for "semmsl"

Check: Kernel parameter for "semmns" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              32000         32000         32000         passed          
  rac1              32000         32000         32000         passed          
Result: Kernel parameter check passed for "semmns"

Check: Kernel parameter for "semopm" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              100           100           100           passed          
  rac1              100           100           100           passed          
Result: Kernel parameter check passed for "semopm"

Check: Kernel parameter for "semmni" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              128           128           128           passed          
  rac1              128           128           128           passed          
Result: Kernel parameter check passed for "semmni"

Check: Kernel parameter for "shmmax" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              1048764416    1048764416    1048764416    passed          
  rac1              1048764416    1048764416    1048764416    passed          
Result: Kernel parameter check passed for "shmmax"

Check: Kernel parameter for "shmmni" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              4096          4096          4096          passed          
  rac1              4096          4096          4096          passed          
Result: Kernel parameter check passed for "shmmni"

Check: Kernel parameter for "shmall" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              2097152       2097152       2097152       passed          
  rac1              2097152       2097152       2097152       passed          
Result: Kernel parameter check passed for "shmall"

Check: Kernel parameter for "file-max" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              6815744       6815744       6815744       passed          
  rac1              6815744       6815744       6815744       passed          
Result: Kernel parameter check passed for "file-max"

Check: Kernel parameter for "ip_local_port_range" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              between 9000.0 & 65500.0  between 9000.0 & 65500.0  between 9000.0 & 65500.0  passed          
  rac1              between 9000.0 & 65500.0  between 9000.0 & 65500.0  between 9000.0 & 65500.0  passed          
Result: Kernel parameter check passed for "ip_local_port_range"

Check: Kernel parameter for "rmem_default" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              262144        262144        262144        passed          
  rac1              262144        262144        262144        passed          
Result: Kernel parameter check passed for "rmem_default"

Check: Kernel parameter for "rmem_max" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              4194304       4194304       4194304       passed          
  rac1              4194304       4194304       4194304       passed          
Result: Kernel parameter check passed for "rmem_max"

Check: Kernel parameter for "wmem_default" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              262144        262144        262144        passed          
  rac1              262144        262144        262144        passed          
Result: Kernel parameter check passed for "wmem_default"

Check: Kernel parameter for "wmem_max" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              1048576       1048576       1048576       passed          
  rac1              1048576       1048576       1048576       passed          
Result: Kernel parameter check passed for "wmem_max"

Check: Kernel parameter for "aio-max-nr" 
  Node Name         Current       Configured    Required      Status        Comment     
  ----------------  ------------  ------------  ------------  ------------  ------------
  rac2              1048576       1048576       1048576       passed          
  rac1              1048576       1048576       1048576       passed          
Result: Kernel parameter check passed for "aio-max-nr"

Check: Package existence for "make" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          make-3.81-3.el5           make-3.81                 passed    
  rac1          make-3.81-3.el5           make-3.81                 passed    
Result: Package existence check passed for "make"

Check: Package existence for "binutils" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          binutils-2.17.50.0.6-20.el5_8.3  binutils-2.17.50.0.6      passed    
  rac1          binutils-2.17.50.0.6-20.el5_8.3  binutils-2.17.50.0.6      passed    
Result: Package existence check passed for "binutils"

Check: Package existence for "gcc(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          gcc(x86_64)-4.1.2-54.el5  gcc(x86_64)-4.1.2         passed    
  rac1          gcc(x86_64)-4.1.2-54.el5  gcc(x86_64)-4.1.2         passed    
Result: Package existence check passed for "gcc(x86_64)"

Check: Package existence for "libaio(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          libaio(x86_64)-0.3.106-5  libaio(x86_64)-0.3.106    passed    
  rac1          libaio(x86_64)-0.3.106-5  libaio(x86_64)-0.3.106    passed    
Result: Package existence check passed for "libaio(x86_64)"

Check: Package existence for "glibc(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          glibc(x86_64)-2.5-107     glibc(x86_64)-2.5-24      passed    
  rac1          glibc(x86_64)-2.5-107     glibc(x86_64)-2.5-24      passed    
Result: Package existence check passed for "glibc(x86_64)"

Check: Package existence for "compat-libstdc++-33(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          compat-libstdc++-33(x86_64)-3.2.3-61  compat-libstdc++-33(x86_64)-3.2.3  passed    
  rac1          compat-libstdc++-33(x86_64)-3.2.3-61  compat-libstdc++-33(x86_64)-3.2.3  passed    
Result: Package existence check passed for "compat-libstdc++-33(x86_64)"

Check: Package existence for "elfutils-libelf(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          elfutils-libelf(x86_64)-0.137-3.el5  elfutils-libelf(x86_64)-0.125  passed    
  rac1          elfutils-libelf(x86_64)-0.137-3.el5  elfutils-libelf(x86_64)-0.125  passed    
Result: Package existence check passed for "elfutils-libelf(x86_64)"

Check: Package existence for "elfutils-libelf-devel" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          elfutils-libelf-devel-0.137-3.el5  elfutils-libelf-devel-0.125  passed    
  rac1          elfutils-libelf-devel-0.137-3.el5  elfutils-libelf-devel-0.125  passed    
Result: Package existence check passed for "elfutils-libelf-devel"

Check: Package existence for "glibc-common" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          glibc-common-2.5-107      glibc-common-2.5          passed    
  rac1          glibc-common-2.5-107      glibc-common-2.5          passed    
Result: Package existence check passed for "glibc-common"

Check: Package existence for "glibc-devel(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          glibc-devel(x86_64)-2.5-107  glibc-devel(x86_64)-2.5   passed    
  rac1          glibc-devel(x86_64)-2.5-107  glibc-devel(x86_64)-2.5   passed    
Result: Package existence check passed for "glibc-devel(x86_64)"

Check: Package existence for "glibc-headers" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          glibc-headers-2.5-107     glibc-headers-2.5         passed    
  rac1          glibc-headers-2.5-107     glibc-headers-2.5         passed    
Result: Package existence check passed for "glibc-headers"

Check: Package existence for "gcc-c++(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          gcc-c++(x86_64)-4.1.2-54.el5  gcc-c++(x86_64)-4.1.2     passed    
  rac1          gcc-c++(x86_64)-4.1.2-54.el5  gcc-c++(x86_64)-4.1.2     passed    
Result: Package existence check passed for "gcc-c++(x86_64)"

Check: Package existence for "libaio-devel(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          libaio-devel(x86_64)-0.3.106-5  libaio-devel(x86_64)-0.3.106  passed    
  rac1          libaio-devel(x86_64)-0.3.106-5  libaio-devel(x86_64)-0.3.106  passed    
Result: Package existence check passed for "libaio-devel(x86_64)"

Check: Package existence for "libgcc(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          libgcc(x86_64)-4.1.2-54.el5  libgcc(x86_64)-4.1.2      passed    
  rac1          libgcc(x86_64)-4.1.2-54.el5  libgcc(x86_64)-4.1.2      passed    
Result: Package existence check passed for "libgcc(x86_64)"

Check: Package existence for "libstdc++(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          libstdc++(x86_64)-4.1.2-54.el5  libstdc++(x86_64)-4.1.2   passed    
  rac1          libstdc++(x86_64)-4.1.2-54.el5  libstdc++(x86_64)-4.1.2   passed    
Result: Package existence check passed for "libstdc++(x86_64)"

Check: Package existence for "libstdc++-devel(x86_64)" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          libstdc++-devel(x86_64)-4.1.2-54.el5  libstdc++-devel(x86_64)-4.1.2  passed    
  rac1          libstdc++-devel(x86_64)-4.1.2-54.el5  libstdc++-devel(x86_64)-4.1.2  passed    
Result: Package existence check passed for "libstdc++-devel(x86_64)"

Check: Package existence for "sysstat" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          sysstat-7.0.2-12.0.1.el5  sysstat-7.0.2             passed    
  rac1          sysstat-7.0.2-12.0.1.el5  sysstat-7.0.2             passed    
Result: Package existence check passed for "sysstat"

Check: Package existence for "ksh" 
  Node Name     Available                 Required                  Status    
  ------------  ------------------------  ------------------------  ----------
  rac2          ksh-20100621-12.el5       ksh-20060214              passed    
  rac1          ksh-20100621-12.el5       ksh-20060214              passed    
Result: Package existence check passed for "ksh"

Checking for multiple users with UID value 0
Result: Check for multiple users with UID value 0 passed 

Check: Current group ID 
Result: Current group ID check passed

Starting check for consistency of primary group of root user
  Node Name                             Status                  
  ------------------------------------  ------------------------
  rac2                                  passed                  
  rac1                                  passed                  

Check for consistency of root user's primary group passed

Starting Clock synchronization checks using Network Time Protocol(NTP)...

NTP Configuration file check started...
Network Time Protocol(NTP) configuration file not found on any of the nodes. Oracle Cluster Time Synchronization Service(CTSS) can be used instead of NTP for time synchronization on the cluster nodes
No NTP Daemons or Services were found to be running

Result: Clock synchronization check using Network Time Protocol(NTP) passed

Checking Core file name pattern consistency...
Core file name pattern consistency check passed.

Checking to make sure user "grid" is not in "root" group
  Node Name     Status                    Comment                 
  ------------  ------------------------  ------------------------
  rac2          passed                    does not exist          
  rac1          passed                    does not exist          
Result: User "grid" is not part of "root" group. Check passed

Check default user file creation mask
  Node Name     Available                 Required                  Comment   
  ------------  ------------------------  ------------------------  ----------
  rac2          0022                      0022                      passed    
  rac1          0022                      0022                      passed    
Result: Default user file creation mask check passed
Checking consistency of file "/etc/resolv.conf" across nodes

Checking the file "/etc/resolv.conf" to make sure only one of domain and search entries is defined
File "/etc/resolv.conf" does not have both domain and search entries defined
Checking if domain entry in file "/etc/resolv.conf" is consistent across the nodes...
domain entry in file "/etc/resolv.conf" is consistent across nodes
Checking if search entry in file "/etc/resolv.conf" is consistent across the nodes...
search entry in file "/etc/resolv.conf" is consistent across nodes
Checking file "/etc/resolv.conf" to make sure that only one search entry is defined
All nodes have one search entry defined in file "/etc/resolv.conf"
Checking all nodes to make sure that search entry is "com.br" as found on node "rac2"
All nodes of the cluster have same value for 'search'
Checking DNS response time for an unreachable node
  Node Name                             Status                  
  ------------------------------------  ------------------------
  rac2                                  passed                  
  rac1                                  passed                  
The DNS response time for an unreachable node is within acceptable limit on all nodes

File "/etc/resolv.conf" is consistent across nodes

Check: Time zone consistency 
Result: Time zone consistency check passed

Pre-check for cluster services setup was successful. 




-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Log para o usuário oracle. Se você estiver usando emulação X em seguida, defina a variável DISPLAY ambiental.
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------

DISPLAY=<machine-name>:0.0; export DISPLAY
	
DISPLAY=:0.0; export DISPLAY
xhost +

-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Iniciar o Oracle Universal Installer (OUI), emitindo o seguinte comando no diretório de banco de dados.
-- ---------------------------------------------------------------------------------------------------------------------------------------------------------------------

-- ---------------------------------------------------------
-- Entre com usuario grid para começar a instalação do GRID
-- ---------------------------------------------------------

/u01/grid/runInstaller
	

-------------------------------------------------------------------------------------------------------------------------
	
-- Verificar se o CRS esta configurado adequadamente.

cluvfy stage -post crsinst -n <node> -verbose

-- exemplo

/u01/app/11.2.0/grid/bin/cluvfy stage -post crsinst -n rac1 -verbose





















-- -----------------------------------------------------------------------------------------------------------------------------------------------------------
-- 
-- -----------------------------------------------------------------------------------------------------------------------------------------------------------




root@rac2 [prod2] $ /u01/app/oraInventory/orainstRoot.sh
Changing permissions of /u01/app/oraInventory.
Adding read,write permissions for group.
Removing read,write,execute permissions for world.

Changing groupname of /u01/app/oraInventory to oinstall.
The execution of the script is complete.
root@rac2 [prod2] $ /u01/app/11.2.0/grid/root.sh
Performing root user operation for Oracle 11g 

The following environment variables are set as:
    ORACLE_OWNER= grid
    ORACLE_HOME=  /u01/app/11.2.0/grid

Enter the full pathname of the local bin directory: [/usr/local/bin]: 
   Copying dbhome to /usr/local/bin ...
   Copying oraenv to /usr/local/bin ...
   Copying coraenv to /usr/local/bin ...


Creating /etc/oratab file...
Entries will be added to the /etc/oratab file as needed by
Database Configuration Assistant when a database is created
Finished running generic part of root script.
Now product-specific root actions will be performed.
Using configuration parameter file: /u01/app/11.2.0/grid/crs/install/crsconfig_params
Creating trace directory
User ignored Prerequisites during installation
OLR initialization - successful
Adding Clusterware entries to inittab
CRS-2672: Attempting to start 'ora.mdnsd' on 'rac2'
CRS-2676: Start of 'ora.mdnsd' on 'rac2' succeeded
CRS-2672: Attempting to start 'ora.gpnpd' on 'rac2'
CRS-2676: Start of 'ora.gpnpd' on 'rac2' succeeded
CRS-2672: Attempting to start 'ora.cssdmonitor' on 'rac2'
CRS-2672: Attempting to start 'ora.gipcd' on 'rac2'
CRS-2676: Start of 'ora.gipcd' on 'rac2' succeeded
CRS-2676: Start of 'ora.cssdmonitor' on 'rac2' succeeded
CRS-2672: Attempting to start 'ora.cssd' on 'rac2'
CRS-2672: Attempting to start 'ora.diskmon' on 'rac2'
CRS-2676: Start of 'ora.diskmon' on 'rac2' succeeded
CRS-2676: Start of 'ora.cssd' on 'rac2' succeeded

Disk Group DGVOT creation failed with the following message:
ORA-15018: diskgroup cannot be created
ORA-15017: diskgroup "DGVOT" cannot be mounted
ORA-15003: diskgroup "DGVOT" already mounted in another lock name space


Configuration of ASM ... failed
see asmca logs at /u01/app/oracle/cfgtoollogs/asmca for details
Did not succssfully configure and start ASM at /u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm line 6763.
/u01/app/11.2.0/grid/perl/bin/perl -I/u01/app/11.2.0/grid/perl/lib -I/u01/app/11.2.0/grid/crs/install /u01/app/11.2.0/grid/crs/install/rootcrs.pl execution failed
You have new mail in /var/spool/mail/root












- Node 2

root@rac2 [prod2] $ /u01/app/11.2.0/grid/root.sh



##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   5b1068a436584f97bf31047aa7d93c6a (/dev/oracleasm/disks/VOTING01) [DGVOT]
Located 1 voting disk(s).
CRS-2672: Attempting to start 'ora.asm' on 'rac2'
CRS-2676: Start of 'ora.asm' on 'rac2' succeeded
CRS-2672: Attempting to start 'ora.DGVOT.dg' on 'rac2'
CRS-2676: Start of 'ora.DGVOT.dg' on 'rac2' succeeded
PRCR-1079 : Failed to start resource ora.scan1.vip
CRS-5017: The resource action "ora.scan1.vip start" encountered the following error: 
CRS-5005: IP Address: 172.16.43.203 is already in use in the network
. For details refer to "(:CLSN00107:)" in "/u01/app/11.2.0/grid/log/rac2/agent/crsd/orarootagent_root/orarootagent_root.log".

CRS-2674: Start of 'ora.scan1.vip' on 'rac2' failed
CRS-2632: There are no more servers to try to place resource 'ora.scan1.vip' on that would satisfy its placement policy
PRCR-1079 : Failed to start resource ora.scan2.vip
CRS-5017: The resource action "ora.scan2.vip start" encountered the following error: 
CRS-5005: IP Address: 172.16.43.201 is already in use in the network
. For details refer to "(:CLSN00107:)" in "/u01/app/11.2.0/grid/log/rac2/agent/crsd/orarootagent_root/orarootagent_root.log".

CRS-2674: Start of 'ora.scan2.vip' on 'rac2' failed
CRS-2632: There are no more servers to try to place resource 'ora.scan2.vip' on that would satisfy its placement policy
PRCR-1079 : Failed to start resource ora.scan3.vip
CRS-5017: The resource action "ora.scan3.vip start" encountered the following error: 
CRS-5005: IP Address: 172.16.43.202 is already in use in the network
. For details refer to "(:CLSN00107:)" in "/u01/app/11.2.0/grid/log/rac2/agent/crsd/orarootagent_root/orarootagent_root.log".

CRS-2674: Start of 'ora.scan3.vip' on 'rac2' failed
CRS-2632: There are no more servers to try to place resource 'ora.scan3.vip' on that would satisfy its placement policy

start scan ... failed
FirstNode configuration failed at /u01/app/11.2.0/grid/crs/install/crsconfig_lib.pm line 9196.
/u01/app/11.2.0/grid/perl/bin/perl -I/u01/app/11.2.0/grid/perl/lib -I/u01/app/11.2.0/grid/crs/install /u01/app/11.2.0/grid/crs/install/rootcrs.pl execution failed






vi /u01/app/oraInventory/logs/installActions2014-09-18_10-56-27AM.log



[oracle@coin2041 [coin1] ~]$ crs_stat -t
Name           Type           Target    State     Host        
------------------------------------------------------------
ora.DGDATA.dg  ora....up.type ONLINE    ONLINE    coin2041    
ora....ORUM.dg ora....up.type ONLINE    ONLINE    coin2041    
ora....ER.lsnr ora....er.type ONLINE    ONLINE    coin2041    

ora....N1.lsnr ora....er.type ONLINE    ONLINE    coin2042    

ora....N2.lsnr ora....er.type ONLINE    ONLINE    coin2041    
ora....N3.lsnr ora....er.type ONLINE    ONLINE    coin2041    
ora.asm        ora.asm.type   ONLINE    ONLINE    coin2041    
ora.coin.db    ora....se.type ONLINE    ONLINE    coin2041    
ora....SM1.asm application    ONLINE    ONLINE    coin2041    
ora....41.lsnr application    ONLINE    ONLINE    coin2041    
ora....041.gsd application    OFFLINE   OFFLINE               
ora....041.ons application    ONLINE    ONLINE    coin2041    
ora....041.vip ora....t1.type ONLINE    ONLINE    coin2041    
ora....SM2.asm application    ONLINE    ONLINE    coin2042    
ora....42.lsnr application    ONLINE    ONLINE    coin2042    
ora....042.gsd application    OFFLINE   OFFLINE               
ora....042.ons application    ONLINE    ONLINE    coin2042    
ora....042.vip ora....t1.type ONLINE    ONLINE    coin2042    
ora.cvu        ora.cvu.type   ONLINE    ONLINE    coin2041    
ora.gsd        ora.gsd.type   OFFLINE   OFFLINE               
ora....network ora....rk.type ONLINE    ONLINE    coin2041    
ora.oc4j       ora.oc4j.type  ONLINE    ONLINE    coin2041    
ora.ons        ora.ons.type   ONLINE    ONLINE    coin2041    
ora....ry.acfs ora....fs.type ONLINE    ONLINE    coin2041    
ora.scan1.vip  ora....ip.type ONLINE    ONLINE    coin2042    
ora.scan2.vip  ora....ip.type ONLINE    ONLINE    coin2041    
ora.scan3.vip  ora....ip.type ONLINE    ONLINE    coin2041   



Name           Type           Target    State     Host        
------------------------------------------------------------
ora.DGVOT.dg   ora....up.type ONLINE    ONLINE    rac1        
ora....ER.lsnr ora....er.type ONLINE    ONLINE    rac1        
ora....N1.lsnr ora....er.type ONLINE    ONLINE    rac1        
ora....N2.lsnr ora....er.type ONLINE    ONLINE    rac1        
ora....N3.lsnr ora....er.type ONLINE    ONLINE    rac1        
ora.asm        ora.asm.type   ONLINE    ONLINE    rac1        
ora.cvu        ora.cvu.type   ONLINE    ONLINE    rac1        
ora.gsd        ora.gsd.type   OFFLINE   OFFLINE               
ora....network ora....rk.type ONLINE    ONLINE    rac1        
ora.oc4j       ora.oc4j.type  ONLINE    ONLINE    rac1        
ora.ons        ora.ons.type   ONLINE    ONLINE    rac1        
ora....SM1.asm application    ONLINE    ONLINE    rac1        
ora....C1.lsnr application    ONLINE    ONLINE    rac1        
ora.rac1.gsd   application    OFFLINE   OFFLINE               
ora.rac1.ons   application    ONLINE    ONLINE    rac1        
ora.rac1.vip   ora....t1.type ONLINE    ONLINE    rac1        
ora.scan1.vip  ora....ip.type ONLINE    ONLINE    rac1        
ora.scan2.vip  ora....ip.type ONLINE    ONLINE    rac1        
ora.scan3.vip  ora....ip.type ONLINE    ONLINE    rac1   